<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panda Clicker</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');
        body {
            width: 100%;
            height: 100%; 
            margin: 0;
            user-select: none;
            background-image: url('./img/bgBamboo.png');
            font-family: "Roboto", Calibri;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 3vw;
        }
        
        .main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1vh;
        }

        .achievements {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1vh;
            right: 3vw;
        }

        img {
            image-rendering: pixelated;
        }

        #click:active img {
            transform: scale(0.95);
            transition: transform 0.05s;
        }
        .header {
            font-size:xx-large;
            color: white;
        }
        button {
        font-family: inherit;
        font-size: 20px;
        background: royalblue;
        color: white;
        padding: 0.7em 1em;
        padding-left: 0.9em;
        display: flex;
        align-items: center;
        border: none;
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.2s;
        cursor: pointer;
        }

        button span {
        display: block;
        margin-left: 0.3em;
        transition: all 0.3s ease-in-out;
        }

        button svg {
        display: block;
        transform-origin: center center;
        transition: transform 0.3s ease-in-out;
        }

        button:hover .svg-wrapper {
        animation: fly-1 0.6s ease-in-out infinite alternate;
        }

        button:hover svg {
        transform: translateX(1.2em) rotate(45deg) scale(1.1);
        }

        button:hover span {
        transform: translateX(5em);
        }

        button:active {
        transform: scale(0.95);
        }

        @keyframes fly-1 {
        from {
            transform: translateY(0.1em);
        }

        to {
            transform: translateY(-0.1em);
        }
        }

    </style>
</head>
<body>
    <div class="main">
        <div id="bps" style="color:white;">Bamboo Per Minute: </div>
        <div id="click_amount" style="color:white;">Click Amount: </div>
        <div class="header" id="bamboo"><img src="./img/bamboo.png" width=32>0</div>
        <button id="click"><img src="./img/panda.png" width=200></button>
        <button id="upgrade_click">Upgrade Click: 101</button>
        <button id="upgrade_frequency">Auto frequency: 101</button>
        <button id="bamboo_miner">Bamboo Miner: 20</button>
        <button id="bamboo_extractor">Bamboo Extractor: 200</button>
        <button id="bamboo_harvester">Bamboo Harvester</button>
        <button id="bamboo_factory">Bamboo Factory</button>
        <button id="bamboo_empire">Bamboo Empire</button>
        <button id="bamboo_civilization">Bamboo Civilization</button>
        <button id="bamboo_world">Bamboo World</button>
        <button id="bamboo_galaxy">Bamboo Galaxy</button>
        <button id="upgrade_all">Upgrade All</button>
        <div class="header">Save Management</div>
        <button id="exportButton">Export</button>
        <div style="color: white;">Import: </div>
        <input type="file" id="importFile" accept=".txt" />
        <button id="reset">Reset Save (Dangerous)</button>
    </div>
    <div class="achievements">
        <img id="1k" style="filter: grayscale(90%);" src="./ach/1k.png" width=50>
        <img id="industrialized" style="filter: grayscale(90%);" src="./ach/industrialized.png" width=50>
        <img id="1m" style="filter: grayscale(90%);" src="./ach/1m.png" width=50>
        <img id="1b" style="filter: grayscale(90%);" src="./ach/1b.png" width=50>
        <img id="otherworldly" style="filter: grayscale(90%);" src="./ach/otherworldly.png" width=50>
        <img id="1t" style="filter: grayscale(90%);" src="./ach/1t.png" width=50>
        <img id="1q" style="filter: grayscale(90%);" src="./ach/1q.png" width=50>
        <img id="1Qu" style="filter: grayscale(90%);" src="./ach/1Qu.png" width=50>
    </div>
    <script>
        console.log("Don't do it.")
        
        let bamboo = BigInt(localStorage.getItem("bamboo") != null ? localStorage.getItem("bamboo") : 0n);
        let clickAmount = parseInt(localStorage.getItem("clickAmount")) || 1;
        let mineAmount = parseInt(localStorage.getItem("mineAmount")) || 0;
        let extractAmount = parseInt(localStorage.getItem("extractAmount")) || 0;
        let harvestAmount = parseInt(localStorage.getItem("harvestAmount")) || 0;
        let factoryAmount = parseInt(localStorage.getItem("factoryAmount")) || 0;
        let empireAmount = parseInt(localStorage.getItem("empireAmount")) || 0;
        let civilizationAmount = parseInt(localStorage.getItem("civilizationAmount")) || 0;
        let worldAmount = parseInt(localStorage.getItem("worldAmount")) || 0;
        let galaxyAmount = parseInt(localStorage.getItem("galaxyAmount")) || 0;
        let allAmount = parseInt(localStorage.getItem("allAmount")) || 1;
        let frequency = parseInt(localStorage.getItem("frequency")) || 500;
        let frequency_amount = parseInt(localStorage.getItem("frequency_amount")) || 0;

        let onekUnlocked = localStorage.getItem("onekUnlocked") === "true";
        let industrializedUnlocked = localStorage.getItem("industrializedUnlocked") === "true";
        let onemUnlocked = localStorage.getItem("onemUnlocked") === "true";
        let onebUnlocked = localStorage.getItem("onebUnlocked") === "true";
        let otherworldlyUnlocked = localStorage.getItem("otherworldlyUnlocked") === "true";
        let onetUnlocked = localStorage.getItem("onetUnlocked") === "true";
        let oneqUnlocked = localStorage.getItem("oneqUnlocked") === "true";
        let oneQuUnlocked = localStorage.getItem("oneQuUnlocked") === "true";

        const click = document.getElementById("click");
        const upgrade_click = document.getElementById("upgrade_click");
        const upgrade_frequency = document.getElementById("upgrade_frequency");
        const bamboo_miner = document.getElementById("bamboo_miner");
        const bamboo_extractor = document.getElementById("bamboo_extractor");
        const bamboo_harvester = document.getElementById("bamboo_harvester");
        const bamboo_factory = document.getElementById("bamboo_factory");
        const bamboo_empire = document.getElementById("bamboo_empire");
        const bamboo_civilization = document.getElementById("bamboo_civilization");
        const bamboo_world = document.getElementById("bamboo_world");
        const bamboo_galaxy = document.getElementById("bamboo_galaxy");
        const upgrade_all = document.getElementById("upgrade_all");
        const exportButton = document.getElementById("exportButton");
        const bps = document.getElementById("bps");
        const click_amount = document.getElementById("click_amount")
        const onek = document.getElementById("1k")
        const industrialized = document.getElementById("industrialized")
        const onem = document.getElementById("1m")
        const oneb = document.getElementById("1b")
        const otherworldly = document.getElementById("otherworldly")
        const onet = document.getElementById("1t")
        const oneq = document.getElementById("1q")
        const oneQu = document.getElementById("1Qu")


        document.getElementById("importFile").addEventListener("change", imprort);
        document.getElementById("reset").onclick = function(){localStorage.clear(); location.reload();}

        const upgradeCosts = {
            click:   { base: 300,   linear: 10000,  expo: 1.01, expoBoost: 3 },
            miner:   { base: 20,    linear: 5,   expo: 1.04, expoBoost: 8 },
            extract: { base: 400,   linear: 20,  expo: 1.05, expoBoost: 12 },
            harv:    { base: 2000,  linear: 50,  expo: 1.05, expoBoost: 15 },
            factory: { base: 50000, linear: 5000, expo: 1.10, expoBoost: 25 },
            emp: { base: 500000, linear: 10000, expo: 1.5, expoBoost: 50 },
            civ: { base: 500000000, linear: 100000, expo: 1.5, expoBoost: 50 },
            world: { base: 5000000000, linear: 1000000, expo: 1.5, expoBoost: 50 },
            gal: { base: 500000000000, linear: 100000000, expo: 1.5, expoBoost: 50 },
            freq:    { base: 1000,  linear: 2000,  expo: 2, expoBoost: 500 },
            all:     { base: 1000000, linear: 5000, expo: 1.3, expoBoost: 10}
        };

        function formatNumber(num) {
            const isBig = typeof num === "bigint";
            let n = isBig ? Number(num) : num;
            if (!Number.isFinite(n)) {
                return num.toString();
            }
            if (n >= 1e36) return n.toExponential(2);
            if (n >= 1e33) return (n / 1e33).toFixed(2).replace(/\.00$/, '') + " decillion";
            if (n >= 1e30) return (n / 1e30).toFixed(2).replace(/\.00$/, '') + " nonillion";
            if (n >= 1e27) return (n / 1e27).toFixed(2).replace(/\.00$/, '') + " octillion";
            if (n >= 1e24) return (n / 1e24).toFixed(2).replace(/\.00$/, '') + " septillion";
            if (n >= 1e21) return (n / 1e21).toFixed(2).replace(/\.00$/, '') + " sextillion";
            if (n >= 1e18) return (n / 1e18).toFixed(2).replace(/\.00$/, '') + " quintillion";
            if (n >= 1e15) return (n / 1e15).toFixed(2).replace(/\.00$/, '') + " quadrillion";
            if (n >= 1e12) return (n / 1e12).toFixed(2).replace(/\.00$/, '') + " trillion";
            if (n >= 1e9)  return (n / 1e9).toFixed(2).replace(/\.00$/, '') + " billion";
            if (n >= 1e6)  return (n / 1e6).toFixed(2).replace(/\.00$/, '') + " million";
            if (n >= 1e3)  return (n / 1e3).toFixed(2).replace(/\.00$/, '') + "K";
            return n.toFixed(2);
        }

        function getCost(type, amount) {
            const cfg = upgradeCosts[type];
            return Math.floor(cfg.base + (amount * cfg.linear) + Math.pow(cfg.expo, amount) * cfg.expoBoost);
        }

        function refresh() {
            localStorage.setItem("bamboo", bamboo);
            localStorage.setItem("clickAmount", clickAmount);
            localStorage.setItem("mineAmount", mineAmount);
            localStorage.setItem("extractAmount", extractAmount);
            localStorage.setItem("harvestAmount", harvestAmount);
            localStorage.setItem("factoryAmount", factoryAmount);
            localStorage.setItem("empireAmount", empireAmount);
            localStorage.setItem("civilizationAmount", civilizationAmount);
            localStorage.setItem("worldAmount", worldAmount);
            localStorage.setItem("galaxyAmount", galaxyAmount);
            localStorage.setItem("allAmount", allAmount);
            localStorage.setItem("frequency", frequency);
            localStorage.setItem("frequency_amount", frequency_amount);

            bamboo > 999 ? onekUnlocked = true : null
            factoryAmount > 1 ? industrializedUnlocked = true : null
            bamboo > 999999 ? onemUnlocked = true : null
            bamboo > 999999999 ? onebUnlocked = true : null
            worldAmount > 1 ? otherworldlyUnlocked = true : null
            bamboo > 999999999999 ? onetUnlocked = true : null
            bamboo > 999999999999999 ? oneqUnlocked = true : null
            bamboo > 999999999999999999 ? oneQuUnlocked = true : null

            localStorage.setItem("onekUnlocked", onekUnlocked);
            localStorage.setItem("industrializedUnlocked", industrializedUnlocked);
            localStorage.setItem("onemUnlocked", onemUnlocked);
            localStorage.setItem("onebUnlocked", onebUnlocked);
            localStorage.setItem("otherworldlyUnlocked", otherworldlyUnlocked);
            localStorage.setItem("onetUnlocked", onetUnlocked);
            localStorage.setItem("oneqUnlocked", oneqUnlocked);
            localStorage.setItem("oneQuUnlocked", oneQuUnlocked);

            onek.style.filter = onekUnlocked ? "grayscale(0%)" : "grayscale(90%)";
            industrialized.style.filter = industrializedUnlocked ? "grayscale(0%)" : "grayscale(90%)";
            onem.style.filter = onemUnlocked ? "grayscale(0%)" : "grayscale(90%)";
            oneb.style.filter = onebUnlocked ? "grayscale(0%)" : "grayscale(90%)";
            otherworldly.style.filter = otherworldlyUnlocked ? "grayscale(0%)" : "grayscale(90%)";
            onet.style.filter = onetUnlocked ? "grayscale(0%)" : "grayscale(90%)";
            oneq.style.filter = oneqUnlocked ? "grayscale(0%)" : "grayscale(90%)";
            oneQu.style.filter = oneQuUnlocked ? "grayscale(0%)" : "grayscale(90%)";

            document.getElementById("bamboo").innerHTML = `<img src="./img/bamboo.png" width=32>${bamboo == 69 ? "nice" : formatNumber(bamboo)}`;
            bps.innerHTML = `Bamboo Per Second: ${formatNumber((((mineAmount + extractAmount + harvestAmount + factoryAmount + empireAmount + civilizationAmount + worldAmount + galaxyAmount) * allAmount * (60000 / frequency))/60))}`;
            click_amount.innerHTML = `Click Amount: ${formatNumber(clickAmount)}`;
            upgrade_click.innerHTML = `Upgrade Click: $${formatNumber(getCost("click", clickAmount))}`;
            upgrade_frequency.innerHTML = `(${frequency > 1 ? frequency_amount : "max"}) Auto Frequency: $${frequency > 1 ? formatNumber(getCost("freq", frequency_amount)) : "not available"}`;
            bamboo_miner.innerHTML = `(${mineAmount}) Bamboo Miner: $${formatNumber(getCost("miner", mineAmount))}`;
            bamboo_extractor.innerHTML = `(${extractAmount / 5}) Bamboo Extractor: $${formatNumber(getCost("extract", extractAmount / 5))}`;
            bamboo_harvester.innerHTML = `(${harvestAmount / 50}) Bamboo Harvester: $${formatNumber(getCost("harv", harvestAmount / 50))}`;
            bamboo_factory.innerHTML = `(${factoryAmount / 100}) Bamboo Factory: $${formatNumber(getCost("factory", factoryAmount / 100))}`;
            bamboo_empire.innerHTML = `(${empireAmount / 1000}) Bamboo Empire: $${formatNumber(getCost("emp", empireAmount / 1000))}`;
            bamboo_civilization.innerHTML = `(${civilizationAmount / 1000000}) Bamboo Civilization: $${formatNumber(getCost("civ", civilizationAmount / 1000000))}`;
            bamboo_world.innerHTML = `(${worldAmount / 1000000000}) Bamboo World: $${formatNumber(getCost("world", worldAmount / 1000000000))}`;
            bamboo_galaxy.innerHTML = `(${galaxyAmount / 1000000000000}) Bamboo Galaxy: $${formatNumber(getCost("gal", galaxyAmount / 1000000000000))}`;
            upgrade_all.innerHTML = `x${formatNumber(allAmount)} Upgrade All: $${formatNumber(getCost("all", allAmount / 100))}`;
        }
        refresh();

        function exprort() {
            const initData = {
                bamboo, clickAmount, mineAmount, extractAmount,
                harvestAmount, factoryAmount, empireAmount, civilizationAmount, worldAmount, galaxyAmount, frequency, 
                frequency_amount, allAmount, onekUnlocked, industrializedUnlocked, onemUnlocked, onebUnlocked,
                onetUnlocked, otherworldlyUnlocked, oneqUnlocked, oneQuUnlocked
            };
            const jsonString = JSON.stringify(initData);
            const base64Data = btoa(jsonString);
            const blob = new Blob([base64Data], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "panda_clicker_export.txt";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            refresh();
        }

        function imprort(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const base64Data = e.target.result.trim();
                    const jsonString = atob(base64Data);
                    const data = JSON.parse(jsonString);
                    bamboo = BigInt(data.bamboo);
                    clickAmount = data.clickAmount;
                    mineAmount = data.mineAmount;
                    extractAmount = data.extractAmount;
                    harvestAmount = data.harvestAmount;
                    factoryAmount = data.factoryAmount;
                    empireAmount = data.empireAmount;
                    civilizationAmount = data.civilizationAmount;
                    worldAmount = data.worldAmount;
                    galaxyAmount = data.galaxyAmount;
                    frequency = data.frequency;
                    frequency_amount = data.frequency_amount;
                    allAmount = data.allAmount;
                    onekUnlocked = data.onekUnlocked;
                    industrializedUnlocked = data.industrializedUnlocked;
                    onemUnlocked = data.onemUnlocked;
                    onebUnlocked = data.onebUnlocked;
                    otherworldlyUnlocked = data.otherworldlyUnlocked;
                    onetUnlocked = data.onetUnlocked;
                    oneqUnlocked = data.oneqUnlocked;
                    oneQuUnlocked = data.oneQuUnlocked;
                    refresh();
                    alert("Import successful!");
                    event.target.value = "";
                } catch (err) {
                    alert("Failed to import: Invalid file or corrupted data.");
                    console.error(err);
                }
            };
            reader.readAsText(file);
        }

        click.onclick = function(){
            bamboo += BigInt(clickAmount);
            refresh();
        };
        upgrade_click.onclick = function(){
            const cost = getCost("click", clickAmount);
            if (bamboo >= cost){
                bamboo -= BigInt(cost);
                clickAmount *= 2;
                refresh();
            }
        };
        upgrade_frequency.onclick = function(){
            const cost = getCost("freq", frequency_amount);
            if (bamboo >= cost){
                if (frequency > 1){
                    bamboo -= BigInt(cost);
                    frequency_amount += 1;
                    frequency /= 1.5;
                    refresh();
                }
            }
        };
        bamboo_miner.onclick = function(){
            const cost = getCost("miner", mineAmount);
            if (bamboo >= cost){
                bamboo -= BigInt(cost);
                mineAmount += 1;
                refresh();
            }
        };
        bamboo_extractor.onclick = function(){
            const cost = getCost("extract", extractAmount / 5);
            if (bamboo >= cost){
                bamboo -= BigInt(cost);
                extractAmount += 5;
                refresh();
            }
        };
        bamboo_harvester.onclick = function(){
            const cost = getCost("harv", harvestAmount / 50);
            if (bamboo >= cost){
                bamboo -= BigInt(cost);
                harvestAmount += 50;
                refresh();
            }
        };
        bamboo_factory.onclick = function(){
            const cost = getCost("factory", factoryAmount / 100);
            if (bamboo >= cost){
                bamboo -= BigInt(cost);
                factoryAmount += 100;
                refresh();
            }
        };
        bamboo_empire.onclick = function(){
            const cost = getCost("emp", empireAmount / 1000);
            if (bamboo >= cost){
                bamboo -= BigInt(cost);
                empireAmount += 1000;
                refresh();
            }
        };
        bamboo_civilization.onclick = function(){
            const cost = getCost("civ", civilizationAmount / 1000000);
            if (bamboo >= cost){
                bamboo -= BigInt(cost);
                civilizationAmount += 1000000;
                refresh();
            }
        };
        bamboo_world.onclick = function(){
            const cost = getCost("world", worldAmount / 1000000000);
            if (bamboo >= cost){
                bamboo -= BigInt(cost);
                worldAmount += 1000000000;
                refresh();
            }
        };
        bamboo_galaxy.onclick = function(){
            const cost = getCost("gal", galaxyAmount / 1000000000000);
            if (bamboo >= cost){
                bamboo -= BigInt(cost);
                galaxyAmount += 1000000000000;
                refresh();
            }
        };
        upgrade_all.onclick = function(){
            const cost = getCost("all", allAmount / 100);
            if (bamboo >= cost){
                bamboo -= BigInt(cost);
                allAmount *= 2;
                refresh();
            }
        };
        exportButton.onclick = exprort;

        function autoCollect() {
            bamboo += BigInt((mineAmount + extractAmount + harvestAmount + factoryAmount + empireAmount + civilizationAmount + worldAmount + galaxyAmount) * allAmount);
            refresh();
            setTimeout(autoCollect, frequency);
        }
        autoCollect();
    </script>
</body>
</html>
