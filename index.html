<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panda Clicker</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');
        body {
            width: 100%;
            height: 100%; 
            margin: 0;
            user-select: none;
            background-image: url('./img/bgBamboo.png');
            font-family: "Roboto", Calibri;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            gap: 1vh;
        }
        
        img {
            image-rendering: pixelated;
        }

        #click:active img {
            transform: scale(0.95);
            transition: transform 0.05s;
        }
        .header {
            font-size:xx-large;
            color: white;
        }
        button {
        font-family: inherit;
        font-size: 20px;
        background: royalblue;
        color: white;
        padding: 0.7em 1em;
        padding-left: 0.9em;
        display: flex;
        align-items: center;
        border: none;
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.2s;
        cursor: pointer;
        }

        button span {
        display: block;
        margin-left: 0.3em;
        transition: all 0.3s ease-in-out;
        }

        button svg {
        display: block;
        transform-origin: center center;
        transition: transform 0.3s ease-in-out;
        }

        button:hover .svg-wrapper {
        animation: fly-1 0.6s ease-in-out infinite alternate;
        }

        button:hover svg {
        transform: translateX(1.2em) rotate(45deg) scale(1.1);
        }

        button:hover span {
        transform: translateX(5em);
        }

        button:active {
        transform: scale(0.95);
        }

        @keyframes fly-1 {
        from {
            transform: translateY(0.1em);
        }

        to {
            transform: translateY(-0.1em);
        }
        }

    </style>
</head>
<body>
    <div id="bps" style="color:white;">Bamboo Per Minute: </div>
    <div class="header" id="bamboo"><img src="./img/bamboo.png" width=32>0</div>
    <button id="click"><img src="./img/panda.png" width=200></button>
    <button id="upgrade_click">Upgrade Click: 101</button>
    <button id="upgrade_frequency">Auto frequency: 101</button>
    <button id="bamboo_miner">Bamboo Miner: 20</button>
    <button id="bamboo_extractor">Bamboo Extractor: 200</button>
    <button id="bamboo_harvester">Bamboo Harvester</button>
    <button id="bamboo_factory">Bamboo Factory</button>
    <div class="header">Save Management</div>
    <button id="exportButton">Export</button>
    <div style="color: white;">Import: </div>
    <input type="file" id="importFile" accept=".txt" />
    <script>
        console.log("Don't do it.")
        let bamboo = parseInt(localStorage.getItem("bamboo")) || 0
        let clickAmount = parseInt(localStorage.getItem("clickAmount")) || 1
        let mineAmount = parseInt(localStorage.getItem("mineAmount")) || 0
        let extractAmount = parseInt(localStorage.getItem("extractAmount")) || 0
        let harvestAmount = parseInt(localStorage.getItem("harvestAmount")) || 0
        let factoryAmount = parseInt(localStorage.getItem("factoryAmount")) || 0
        let click = document.getElementById("click")
        let upgrade_click = document.getElementById("upgrade_click")
        let upgrade_frequency = document.getElementById("upgrade_frequency")
        let bamboo_miner = document.getElementById("bamboo_miner")
        let bamboo_extractor = document.getElementById("bamboo_extractor")
        let bamboo_harvester = document.getElementById("bamboo_harvester")
        let bamboo_factory = document.getElementById("bamboo_factory")
        let exportButton = document.getElementById("exportButton")
        let frequency = parseInt(localStorage.getItem("frequency")) || 500
        let frequency_amount = parseInt(localStorage.getItem("frequency_amount")) || 0
        let bps = document.getElementById("bps")

        document.getElementById("importFile").addEventListener("change", imprort);

        function refresh() {
            localStorage.setItem("bamboo", bamboo)
            localStorage.setItem("clickAmount", clickAmount)
            localStorage.setItem("mineAmount", mineAmount)
            localStorage.setItem("extractAmount", extractAmount)
            localStorage.setItem("harvestAmount", harvestAmount)
            localStorage.setItem("factoryAmount", factoryAmount)
            localStorage.setItem("frequency", frequency)
            localStorage.setItem("frequency_amount", frequency_amount)
            document.getElementById("bamboo").innerHTML = `<img src="./img/bamboo.png" width=32>${bamboo == 69 ? "nice" : bamboo}`
            document.getElementById("bps").innerHTML = `Bamboo Per Second: ${(((mineAmount + extractAmount + harvestAmount + factoryAmount) * (60000 / frequency))/60).toFixed(2)}` 
            upgrade_click.innerHTML = "(" + (clickAmount - 1) + ") " + "Upgrade Click: $" + ((clickAmount ** 7) + 300)
            upgrade_frequency.innerHTML = "(" + frequency_amount + ") " + "Auto Frequency: $" + (((frequency_amount * 2) ** 5) + 1000)
            bamboo_miner.innerHTML = "(" + (mineAmount) + ") " + "Bamboo Miner: $" + (mineAmount ** 3 + 20)
            bamboo_extractor.innerHTML = "(" + (extractAmount / 5) + ") " + "Bamboo Extractor: $" + (extractAmount ** 3 + 400)
            bamboo_harvester.innerHTML = "(" + (harvestAmount / 50) + ") " + "Bamboo Harvester: $" + (harvestAmount ** 2 + 2000)
            bamboo_factory.innerHTML = "(" + (factoryAmount / 100) + ") " + "Bamboo Factory: $" + (factoryAmount ** 2 + 50000)
        }
        refresh()

        function exprort(){
            const initData = {
                "bamboo": bamboo,
                "clickAmount": clickAmount,
                "mineAmount": mineAmount,
                "extractAmount": extractAmount,
                "harvestAmount": harvestAmount,
                "factoryAmount": factoryAmount,
                "frequency": frequency,
                "frequency_amount": frequency_amount,
            };

            const jsonString = JSON.stringify(initData);

            const base64Data = btoa(jsonString);

            const blob = new Blob([base64Data], { type: "text/plain" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = "panda_clicker_export.txt";
            document.body.appendChild(a);
            a.click();

            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            refresh()
        };
        
        function imprort(event) {
            const fileInput = event.target;
            const file = fileInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const base64Data = e.target.result.trim();
                    const jsonString = atob(base64Data);
                    const data = JSON.parse(jsonString);
                    bamboo = data.bamboo;
                    clickAmount = data.clickAmount;
                    mineAmount = data.mineAmount;
                    extractAmount = data.extractAmount;
                    harvestAmount = data.harvestAmount;
                    factoryAmount = data.factoryAmount;
                    frequency = data.frequency;
                    frequency_amount = data.frequency_amount;
                    refresh();
                    alert("Import successful!");
                    fileInput.value = "";
                } catch (err) {
                    alert("Failed to import: Invalid file or corrupted data.");
                    console.error(err);
                }
            };
            reader.readAsText(file);
        };

        click.onclick = function(){
            bamboo += clickAmount
            refresh()
        }
        upgrade_click.onclick = function(){
            const cost = (clickAmount ** 7) + 300
            if (bamboo >= cost){
                bamboo -= cost
                clickAmount *= 2
                refresh()
            }
        }
        upgrade_frequency.onclick = function(){
            const cost = ((frequency_amount * 2) ** 5) + 1000
            if (bamboo >= cost){
                bamboo -= cost
                frequency_amount += 1
                frequency /= 2
                refresh()
            }
        }
        bamboo_miner.onclick = function(){
            const cost = mineAmount ** 3 + 20
            if (bamboo >= cost){
                bamboo -= cost
                mineAmount += 1
                refresh()
            }
        }
        bamboo_extractor.onclick = function(){
            const cost = extractAmount ** 3 + 400
            if (bamboo >= cost){
                bamboo -= cost
                extractAmount += 5
                refresh()
            }
        }
        bamboo_harvester.onclick = function(){
            const cost = harvestAmount ** 2 + 2000
            if (bamboo >= cost){
                bamboo -= cost
                harvestAmount += 50
                refresh()
            }
        }
        bamboo_factory.onclick = function(){
            const cost = factoryAmount ** 2 + 50000
            if (bamboo >= cost){
                bamboo -= cost
                factoryAmount += 100
                refresh()
            }
        }
        exportButton.onclick = function(){
            exprort()
        }
        setInterval(() => { 
            bamboo += mineAmount;
            bamboo += extractAmount;
            bamboo += harvestAmount;
            bamboo += factoryAmount;
            refresh();
        }, frequency);
    </script>
</body>
</html>
