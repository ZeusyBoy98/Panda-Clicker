<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panda Clicker</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');
        body {
            width: 100%;
            height: 100%; 
            margin: 0;
            user-select: none;
            background-image: url('./img/bgBamboo.png');
            font-family: "Roboto", Calibri;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            gap: 1vh;
        }
        
        img {
            image-rendering: pixelated;
        }

        #click:active img {
            transform: scale(0.95);
            transition: transform 0.05s;
        }
        .header {
            font-size:xx-large;
            color: white;
        }
        button {
        font-family: inherit;
        font-size: 20px;
        background: royalblue;
        color: white;
        padding: 0.7em 1em;
        padding-left: 0.9em;
        display: flex;
        align-items: center;
        border: none;
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.2s;
        cursor: pointer;
        }

        button span {
        display: block;
        margin-left: 0.3em;
        transition: all 0.3s ease-in-out;
        }

        button svg {
        display: block;
        transform-origin: center center;
        transition: transform 0.3s ease-in-out;
        }

        button:hover .svg-wrapper {
        animation: fly-1 0.6s ease-in-out infinite alternate;
        }

        button:hover svg {
        transform: translateX(1.2em) rotate(45deg) scale(1.1);
        }

        button:hover span {
        transform: translateX(5em);
        }

        button:active {
        transform: scale(0.95);
        }

        @keyframes fly-1 {
        from {
            transform: translateY(0.1em);
        }

        to {
            transform: translateY(-0.1em);
        }
        }

    </style>
</head>
<body>
    <div id="bps" style="color:white;">Bamboo Per Minute: </div>
    <div id="click_amount" style="color:white;">Click Amount: </div>
    <div class="header" id="bamboo"><img src="./img/bamboo.png" width=32>0</div>
    <button id="click"><img src="./img/panda.png" width=200></button>
    <button id="upgrade_click">Upgrade Click: 101</button>
    <button id="upgrade_frequency">Auto frequency: 101</button>
    <button id="bamboo_miner">Bamboo Miner: 20</button>
    <button id="bamboo_extractor">Bamboo Extractor: 200</button>
    <button id="bamboo_harvester">Bamboo Harvester</button>
    <button id="bamboo_factory">Bamboo Factory</button>
    <div class="header">Save Management</div>
    <button id="exportButton">Export</button>
    <div style="color: white;">Import: </div>
    <input type="file" id="importFile" accept=".txt" />
    <script>
        console.log("Don't do it.")

        let bamboo = parseInt(localStorage.getItem("bamboo")) || 0;
        let clickAmount = parseInt(localStorage.getItem("clickAmount")) || 1;
        let mineAmount = parseInt(localStorage.getItem("mineAmount")) || 0;
        let extractAmount = parseInt(localStorage.getItem("extractAmount")) || 0;
        let harvestAmount = parseInt(localStorage.getItem("harvestAmount")) || 0;
        let factoryAmount = parseInt(localStorage.getItem("factoryAmount")) || 0;
        let frequency = parseInt(localStorage.getItem("frequency")) || 500;
        let frequency_amount = parseInt(localStorage.getItem("frequency_amount")) || 0;

        // elements
        const click = document.getElementById("click");
        const upgrade_click = document.getElementById("upgrade_click");
        const upgrade_frequency = document.getElementById("upgrade_frequency");
        const bamboo_miner = document.getElementById("bamboo_miner");
        const bamboo_extractor = document.getElementById("bamboo_extractor");
        const bamboo_harvester = document.getElementById("bamboo_harvester");
        const bamboo_factory = document.getElementById("bamboo_factory");
        const exportButton = document.getElementById("exportButton");
        const bps = document.getElementById("bps");
        const click_amount = document.getElementById("click_amount")

        document.getElementById("importFile").addEventListener("change", imprort);

        const upgradeCosts = {
            click:   { base: 300,   linear: 10000,  expo: 1.05, expoBoost: 10 },
            miner:   { base: 20,    linear: 5,   expo: 1.04, expoBoost: 8 },
            extract: { base: 400,   linear: 20,  expo: 1.05, expoBoost: 12 },
            harv:    { base: 2000,  linear: 50,  expo: 1.05, expoBoost: 15 },
            factory: { base: 50000, linear: 5000, expo: 1.10, expoBoost: 25 },
            freq:    { base: 1000,  linear: 2000,  expo: 2, expoBoost: 500 }
        };

        function getCost(type, amount) {
            const cfg = upgradeCosts[type];
            return Math.floor(cfg.base + (amount * cfg.linear) + Math.pow(cfg.expo, amount) * cfg.expoBoost);
        }

        function refresh() {
            localStorage.setItem("bamboo", bamboo);
            localStorage.setItem("clickAmount", clickAmount);
            localStorage.setItem("mineAmount", mineAmount);
            localStorage.setItem("extractAmount", extractAmount);
            localStorage.setItem("harvestAmount", harvestAmount);
            localStorage.setItem("factoryAmount", factoryAmount);
            localStorage.setItem("frequency", frequency);
            localStorage.setItem("frequency_amount", frequency_amount);

            document.getElementById("bamboo").innerHTML = `<img src="./img/bamboo.png" width=32>${bamboo == 69 ? "nice" : bamboo}`;
            bps.innerHTML = `Bamboo Per Second: ${(((mineAmount + extractAmount + harvestAmount + factoryAmount) * (60000 / frequency))/60).toFixed(2)}`;
            click_amount.innerHTML = `Click Amount: ${(clickAmount)}`
            upgrade_click.innerHTML = `(${clickAmount - 1}) Upgrade Click: $${getCost("click", clickAmount - 1)}`;
            upgrade_frequency.innerHTML = `(${frequency > 1 ? frequency_amount : "max"}) Auto Frequency: $${frequency > 1 ? ("freq", frequency_amount) : "not available"}`;
            bamboo_miner.innerHTML = `(${mineAmount}) Bamboo Miner: $${getCost("miner", mineAmount)}`;
            bamboo_extractor.innerHTML = `(${extractAmount / 5}) Bamboo Extractor: $${getCost("extract", extractAmount / 5)}`;
            bamboo_harvester.innerHTML = `(${harvestAmount / 50}) Bamboo Harvester: $${getCost("harv", harvestAmount / 50)}`;
            bamboo_factory.innerHTML = `(${factoryAmount / 100}) Bamboo Factory: $${getCost("factory", factoryAmount / 100)}`;
        }
        refresh();

        function exprort() {
            const initData = {
                bamboo, clickAmount, mineAmount, extractAmount,
                harvestAmount, factoryAmount, frequency, frequency_amount
            };
            const jsonString = JSON.stringify(initData);
            const base64Data = btoa(jsonString);
            const blob = new Blob([base64Data], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "panda_clicker_export.txt";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            refresh();
        }

        function imprort(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const base64Data = e.target.result.trim();
                    const jsonString = atob(base64Data);
                    const data = JSON.parse(jsonString);
                    bamboo = data.bamboo;
                    clickAmount = data.clickAmount;
                    mineAmount = data.mineAmount;
                    extractAmount = data.extractAmount;
                    harvestAmount = data.harvestAmount;
                    factoryAmount = data.factoryAmount;
                    frequency = data.frequency;
                    frequency_amount = data.frequency_amount;
                    refresh();
                    alert("Import successful!");
                    event.target.value = "";
                } catch (err) {
                    alert("Failed to import: Invalid file or corrupted data.");
                    console.error(err);
                }
            };
            reader.readAsText(file);
        }

        click.onclick = function(){
            bamboo += clickAmount;
            refresh();
        };
        upgrade_click.onclick = function(){
            const cost = getCost("click", clickAmount - 1);
            if (bamboo >= cost){
                bamboo -= cost;
                clickAmount *= 2;
                refresh();
            }
        };
        upgrade_frequency.onclick = function(){
            const cost = getCost("freq", frequency_amount);
            if (bamboo >= cost && frequency > 1){
                bamboo -= cost;
                frequency_amount += 1;
                frequency /= 1.2;
                refresh();
            }
        };
        bamboo_miner.onclick = function(){
            const cost = getCost("miner", mineAmount);
            if (bamboo >= cost){
                bamboo -= cost;
                mineAmount += 1;
                refresh();
            }
        };
        bamboo_extractor.onclick = function(){
            const cost = getCost("extract", extractAmount / 5);
            if (bamboo >= cost){
                bamboo -= cost;
                extractAmount += 5;
                refresh();
            }
        };
        bamboo_harvester.onclick = function(){
            const cost = getCost("harv", harvestAmount / 50);
            if (bamboo >= cost){
                bamboo -= cost;
                harvestAmount += 50;
                refresh();
            }
        };
        bamboo_factory.onclick = function(){
            const cost = getCost("factory", factoryAmount / 100);
            if (bamboo >= cost){
                bamboo -= cost;
                factoryAmount += 100;
                refresh();
            }
        };
        exportButton.onclick = exprort;

        function autoCollect() {
            bamboo += mineAmount + extractAmount + harvestAmount + factoryAmount;
            refresh();
            setTimeout(autoCollect, frequency);
        }
        autoCollect();
    </script>
</body>
</html>
